<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from site/src/site/markdown/flickrCrawler.md at 2018-10-14
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20181014" />
    <meta http-equiv="Content-Language" content="en" />
    <title>OpenIMAJ: Intelligent Multimedia Analysis &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
<meta property="fb:admins" content="286108206" />
			<meta property="og:type" content="website" />
			<link rel="image_src" href="http://openimaj.org/images/OpenImaj-sq.png" />
			<link rel="stylesheet" href="./css/example-carousel.css" />
			<meta property="og:image" content="http://openimaj.org/images/OpenImaj-sq.png" />
			<meta property="og:title" content="OpenIMAJ: Open Intelligent Multimedia Analysis" />
			<meta property="og:url" content="http://www.openimaj.org" />
			<meta property="og:description" content="OpenIMAJ is an award-winning set of libraries and tools for multimedia content analysis and content generation." />
			<link rel="stylesheet" href="http://yandex.st/highlightjs/7.3/styles/default.min.css" />
<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>
			<script src="http://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.7.0/mustache.min.js" type="text/javascript" charset="utf-8"></script>
			<style type="text/css">
				p {
					text-align: justify;
				}
				
				#module {
					float: right;
					width: 380px;
					margin: 0 0 20px 1em;
					background-color: rgb(29, 76, 116);
					padding-left: 1em;
					padding-right: 1em;
					color: whitesmoke;
					-webkit-border-radius: 4px;
					-moz-border-radius: 4px;
					border-radius: 4px;
				}
				
				.module_body{
					background-color: white;
					margin-top: 1em;
					padding: 1em;
					//width: 85%;
					font-size: x-small;
				}
				.module_head{
					font-size: 24px;
					padding-top: 1em;
					font-weight:bold;
				}
				#banner {
					margin-top: 40px;
				}

				#breadcrumbs {
					position: fixed;
					left:0;
					right:0;
					top:40px;
					background-color: #f5f5f5;
				}

				#bannerLeft h2 {
					display: none;
				}

				#breadcrumbs ul.breadcrumb {
					width: 1000px;
					margin-left: auto;
					margin-right: auto;
				}

				.container {
					width:1000px;
				}

				.navbar-static-top .container, .navbar-fixed-top .container, .navbar-fixed-bottom .container {
					width:1000px;	
				}
				
				.navbar .brand {
					padding-top:5px;
					padding-bottom:5px;
				}
			</style>
    <!-- Google Analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-38338744-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body class="topBarEnabled">
    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
            <div class="container"><div class="nav-collapse">
<a class="brand" href="http://openimaj.org/index.html"  title="OpenIMAJ"><img src="http://openimaj.org/images/logo-tiny.png" alt="OpenIMAJ" />
</a>
            <ul class="nav">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="index.html" title="Introduction">Introduction</a></li>
            <li><a href="sponsors.html" title="History & Sponsors">History & Sponsors</a></li>
            <li><a href="contact.html" title="Support & Contacts">Support & Contacts</a></li>
            <li><a href="team.html" title="Team">Team</a></li>
            <li><a href="http://blogs.ecs.soton.ac.uk/multimedia" title="The Blog">The Blog</a></li>
            <li><a href="http://www.sf.net/p/openimaj/code" title="Source Code">Source Code</a></li>
            <li class="dropdown-submenu">
<a href="#related" title="Related Projects">Related Projects</a>
              <ul class="dropdown-menu">
                  <li><a href="http://www.imageterrier.org/" title="ImageTerrier">ImageTerrier</a></li>
              </ul>
            </li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="#gettingstarted" title="Getting Started">Getting Started</a>
              <ul class="dropdown-menu">
                  <li><a href="tutorial-pdf.pdf" title="The Tutorial (PDF)">The Tutorial (PDF)</a></li>
                  <li><a href="tutorial/index.html" title="The Tutorial (HTML)">The Tutorial (HTML)</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="#using" title="Using OpenIMAJ">Using OpenIMAJ</a>
              <ul class="dropdown-menu">
                  <li><a href="https://github.com/openimaj/openimaj/wiki/Compiling-OpenIMAJ-from-Source" title="Building OpenIMAJ from Source">Building OpenIMAJ from Source</a></li>
                  <li><a href="UseLibrary.html" title="Using OpenIMAJ as a Library">Using OpenIMAJ as a Library</a></li>
                  <li><a href="Groovy.html" title="Using OpenIMAJ with Groovy">Using OpenIMAJ with Groovy</a></li>
                  <li><a href="tools.html" title="OpenIMAJ commandline tools introduction">OpenIMAJ commandline tools introduction</a></li>
                  <li><a href="flickrCrawler.html" title="The FlickrCrawler Tool">The FlickrCrawler Tool</a></li>
              </ul>
            </li>
            <li><a href="apidocs/index.html" title="API Reference">API Reference</a></li>
            <li><a href="bibliography.html" title="Bibliography">Bibliography</a></li>
            <li class="dropdown-submenu">
<a href="#info" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="plugin-management.html" title="Plugin Management">Plugin Management</a></li>
                  <li><a href="mail-lists.html" title="Mailing Lists">Mailing Lists</a></li>
                  <li><a href="integration.html" title="Continuous Integration">Continuous Integration</a></li>
                  <li><a href="license.html" title="Project License">Project License</a></li>
                  <li><a href="team-list.html" title="Project Team">Project Team</a></li>
                  <li><a href="source-repository.html" title="Source Repository">Source Repository</a></li>
                  <li><a href="index.html" title="About">About</a></li>
                  <li><a href="issue-tracking.html" title="Issue Tracking">Issue Tracking</a></li>
                  <li><a href="project-summary.html" title="Project Summary">Project Summary</a></li>
                  <li><a href="plugins.html" title="Project Plugins">Project Plugins</a></li>
                  <li><a href="dependency-convergence.html" title="Dependency Convergence">Dependency Convergence</a></li>
                  <li><a href="dependencies.html" title="Dependencies">Dependencies</a></li>
              </ul>
            </li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="openimaj-maven-archetypes/index.html" title="OpenIMAJ Maven Archetypes">OpenIMAJ Maven Archetypes</a></li>
            <li><a href="openimaj-core-libs/index.html" title="OpenIMAJ Core Libraries">OpenIMAJ Core Libraries</a></li>
            <li><a href="openimaj-image/index.html" title="OpenIMAJ Image Processing Libraries">OpenIMAJ Image Processing Libraries</a></li>
            <li><a href="openimaj-video/index.html" title="OpenIMAJ Video Processing Libraries">OpenIMAJ Video Processing Libraries</a></li>
            <li><a href="openimaj-audio/index.html" title="OpenIMAJ Audio Processing Libraries">OpenIMAJ Audio Processing Libraries</a></li>
            <li><a href="openimaj-machine-learning/index.html" title="OpenIMAJ Machine Learning Subprojects">OpenIMAJ Machine Learning Subprojects</a></li>
            <li><a href="openimaj-text/index.html" title="OpenIMAJ Text Analysis Subprojects">OpenIMAJ Text Analysis Subprojects</a></li>
            <li><a href="thirdparty/index.html" title="OpenIMAJ Third Party Ported Libraries">OpenIMAJ Third Party Ported Libraries</a></li>
            <li><a href="openimaj-demos/index.html" title="OpenIMAJ Demos Subproject">OpenIMAJ Demos Subproject</a></li>
            <li><a href="openimaj-knowledge/index.html" title="OpenIMAJ Knowledge Representation and Reasoning Libraries">OpenIMAJ Knowledge Representation and Reasoning Libraries</a></li>
            <li><a href="test-resources/index.html" title="OpenIMAJ Unit Test Resources">OpenIMAJ Unit Test Resources</a></li>
            <li><a href="openimaj-tools/index.html" title="OpenIMAJ Tools">OpenIMAJ Tools</a></li>
            <li><a href="openimaj-hadoop/index.html" title="OpenIMAJ Hadoop Subproject">OpenIMAJ Hadoop Subproject</a></li>
            <li><a href="openimaj-streams/index.html" title="OpenIMAJ Streams Subproject">OpenIMAJ Streams Subproject</a></li>
            <li><a href="openimaj-web/index.html" title="OpenIMAJ web subproject">OpenIMAJ web subproject</a></li>
            <li><a href="openimaj-hardware/index.html" title="OpenIMAJ Hardware Subprojects">OpenIMAJ Hardware Subprojects</a></li>
            <li><a href="openimaj-content-libs/index.html" title="OpenIMAJ Content Creation Libraries">OpenIMAJ Content Creation Libraries</a></li>
            <li><a href="openimaj-ide-integration/index.html" title="OpenIMAJ IDE Integration Plugins">OpenIMAJ IDE Integration Plugins</a></li>
            <li><a href="openimaj-documentation/index.html" title="OpenIMAJ Documentation">OpenIMAJ Documentation</a></li>
        </ul>
      </li>
            </ul>
<form id="search-form" action="https://www.google.com/search" method="get"  class="navbar-search pull-right" >
  <input value="$sitesearchValue" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript">asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
    <iframe src="https://www.facebook.com/plugins/like.php?href=http://www.openimaj.org&send=false&layout=button_count&show-faces=false&action=like&colorscheme=dark"
        scrolling="no" frameborder="0"
        style="border:none; width:100px; height:20px; margin-top: 10px;"  class="pull-right" ></iframe>
    <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
    <ul class="nav pull-right"><li style="margin-top: 10px;">
    <div class="g-plusone" data-href="http://www.openimaj.org" data-size="medium"  width="60px" align="right" ></div>
    </li></ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>OpenIMAJ</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2018-10-14</li>
          <li id="projectVersion" class="pull-right">Version: 1.3.8</li>
        </ul>
      </div>
        <div id="bodyColumn" >
<p>The OpenIMAJ FlickrCrawler tools enable you to download large collections of images using the Flickr API for experimentation purposes. The FlickCrawler tools are implemented as simple <a class="externalLink" href="http://groovy.codehaus.org">Groovy</a> scripts, and as such require that you have Groovy version 1.7 or later installed on your system.</p>
<h1>The FlickrCrawler.groovy Script</h1>
<p>The FlickrCrawler.groovy script is the main tool for downloading images using the <a class="externalLink" href="http://www.flickr.com/services/api/flickr.photos.search.html">flickr.photos.search</a> API. It has a number of useful features:</p>
<ul>

<li>Support for stopping and resuming image crawls.</li>
<li>Ability to download metadata and EXIF for each image crawled.</li>
<li>Ability to configure complex multi-parameter API queries.</li>
<li>Control over the sizes of images being downloaded.
<ul>

<li>Specify an ordered list of preferred size and the first available one will be downloaded,</li>
<li>and/or force the download of any/all specific sizes.</li>
</ul>
</li>
</ul>
<p>The FlickrCrawler.groovy script is invoked from the command-line as follows:</p>

<div>
<div>
<pre class="source">groovy FlickrCrawler.groovy config_file
</pre></div></div>

<p>where <tt>config_file</tt> is the path to the configuration file that describes the parameters of your crawl, as described below.</p>
<div class="section">
<h2><a name="FlickrCrawler_Configuration"></a>FlickrCrawler Configuration</h2>
<p>The FlickrCrawler.groovy configuration file is a simple text file that contains the information the crawler needs to find the relevant images to download. A complete configuration file will look like the following:</p>

<div>
<div>
<pre class="source">crawler {
	apikey=&quot;ENTER_YOUR_FLICKR_API_KEY_HERE&quot; //your flickr api key
	secret=&quot;ENTER_YOUR_FLICKR_API_SECRET_HERE&quot; //your flickr api secret
	apihitfreq=1000 //number of milliseconds between api calls
	hitfreq=1000    //number of milliseconds between retries of failed downloads
	outputdir=&quot;crawl-data&quot;   //name of directory to save images and data to
	maximages=-1    //limit the number of images to be downloaded; -1 is unlimited
	maxRetries=3000 //maximum number of retries after failed api calls
	force=false     //force re-download of duplicate images
	perpage=500     //number of results to request from the api per call
	queryparams {   //the parameters describing the query
	
	}
	concurrentDownloads=16  //max number of concurrent image downloads
	pagingLimit=20          //max number of pages to look through
	maxretrytime=300000     //maximum amout of time between retries
	data {                  
	    info=true           //download all the information about each image
	    exif=true           //download all the exif information about each image
	}
	images {
		targetSize=[&quot;large&quot;,&quot;original&quot;] //preferred image sizes in order
		smallSquare=false               //should small square images be downloaded
        thumbnail=false                 //should thumbnail images be downloaded
        small=false                     //should small images be downloaded
        medium=false                    //should medium images be downloaded
        large=false                     //should large images be downloaded
        original=false                  //should original size images be downloaded
	}
}
</pre></div></div>

<p>In practice however, the crawler has sensible defaults for most of the configuration and many of the options can be omitted. For most crawls, the important parts of the configuration are:</p>
<ul>

<li><tt>crawler.apikey</tt>. This is your Flickr API key; if you don&#x2019;t have one you can generate one <a class="externalLink" href="http://www.flickr.com/services/api/keys/">here</a>.</li>
<li><tt>crawler.secret</tt>. This is your Flickr API secret which you got when you generated your key.</li>
<li><tt>crawler.outputdir</tt>. This specifies where you want to save the images.</li>
<li><tt>crawler.maximages</tt>. This specifies how many images you want.</li>
<li><tt>crawler.images.targetSize</tt>. This specifies which size of image you would prefer.</li>
<li><tt>crawler.data.info</tt>. This specifies whether the crawler should attempt to download all the available metadata for an image. Normally you don&#x2019;t want this as the crawl will be very slow as this creates many extra API calls. Even if this is set to false, a large amount of metadata will be downloaded to the images.csv file automatically (see below).</li>
<li><tt>crawler.data.exif</tt>. This specifies whether the crawler should attempt to download all the available EXIF data for an image. Normally you don&#x2019;t want this as the crawl will be very slow as this creates many extra API calls.</li>
<li><tt>crawler.queryparams</tt>. This is where the query to the <a class="externalLink" href="http://www.flickr.com/services/api/flickr.photos.search.html">flickr.photos.search</a> is configured. See below for some example configurations. The <a class="externalLink" href="http://www.flickr.com/services/api/flickr.photos.search.html">flickr.photos.search</a> page describes the various search options available. Note that in the parameters described on the Flickr API options page are written with underscores, however in the configuration file they must be written as camelCase (i.e. the content_type option would be written as contentType in the configuration file).</li>
</ul>
<div class="section">
<h3><a name="Example_Crawl_Configurations"></a>Example Crawl Configurations</h3>
<p>The following examples demonstrate practical usage of FlickrCrawler.groovy.</p>
<div class="section">
<h4><a name="Example_1:_Creative-commons_images_of_Southampton"></a>Example 1: Creative-commons images of Southampton</h4>
<p>The following configuration can be used used to download all of the geo-tagged images from Southampton, UK that are licensed with the <a class="externalLink" href="http://creativecommons.org/licenses/by-nc/2.0/">Creative Commons Attribution-NonCommercial License</a>:</p>

<div>
<div>
<pre class="source">crawler {
	apikey=&quot;...&quot;
	secret=&quot;...&quot;
	outputdir=&quot;southampton-cc&quot;
	queryparams {
		woeId=&quot;35356&quot; //from flickr.places.find
		license=&quot;2&quot; //from flickr.photos.licenses.getInfo
	}
	data {
	    info=false
	    exif=false
	}
	images {
		targetSize=[&quot;large&quot;, &quot;original&quot;, &quot;medium&quot;]
	}
}
</pre></div></div>

<p>The important parts of the configuration are <tt>crawler.queryparams.woeId</tt> which tells the crawler to find images with the specified flickr <tt>where-on-earth identifier</tt>, and the <tt>crawler.queryparams.license</tt> which specifies the license requirements for the downloaded images. Specific <tt>woeId</tt>s can be looked up using the <a class="externalLink" href="http://www.flickr.com/services/api/explore/?method=flickr.places.find">flickr.places.find explorer page</a>. The mapping between actual licenses and license identifiers can be found on the <a class="externalLink" href="http://www.flickr.com/services/api/explore/?method=flickr.photos.licenses.getInfo">flickr.photos.licenses.getInfo explorer page</a>.</p></div>
<div class="section">
<h4><a name="Example_2:_Images_tagged_with_.E2.80.9Ccity.E2.80.9D_but_not_.E2.80.9Cnight.E2.80.9D"></a>Example 2: Images tagged with &#x201c;city&#x201d; but not &#x201c;night&#x201d;</h4>
<p>The following configuration illustrates how the FlickrCrawler.groovy script can be made to download 100 images tagged with &#x201c;city&#x201d; but not &#x201c;night&#x201d;:</p>

<div>
<div>
<pre class="source">crawler {
    apikey=&quot;...&quot;
    secret=&quot;...&quot;
    outputdir=&quot;city-not-night&quot;
	maximages=100
    queryparams {
        tags=[&quot;city&quot;, &quot;-night&quot;]
		tagMode=&quot;bool&quot;
    }
    data {
        info=false
        exif=false
    }
    images {
        targetSize=[&quot;large&quot;, &quot;original&quot;, &quot;medium&quot;]
    }
}
</pre></div></div>

<p>The <tt>crawler.queryparams</tt> part is self explanatory. It should be noted however, that the Flickr API will not allow you to search only with negative terms, so it isn&#x2019;t possible to to search for just &#x201c;not night&#x201d;.</p></div></div></div>
<div class="section">
<h2><a name="Crawl_output_and_images.csv"></a>Crawl output and images.csv</h2>
<p>As the crawler runs it will download images to a directory structure inside the <tt>outputdir</tt> specified in the configuration. In addition to the images, the directory contains a number of other files which relate to the crawl:</p>
<ul>

<li><tt>crawler.config</tt> contains a complete copy of the crawler configuration with all the default variables expanded. Do not edit this file.</li>
<li><tt>crawler.state</tt> contains internal information about the state of the crawl, and can be used by the crawler to resume if it is interrupted.</li>
<li><tt>crawler-info.log</tt> contains a log of the crawlers actions.</li>
<li><tt>images.csv</tt> contains a large amount of metadata about each downloaded image in CSV format, which each line corresponding to a single image. Specifically the fields correspond to all the metadata that the flickr.photo.search API can return with each list of images:
<ol style="list-style-type: decimal">

<li>The flickr farm identifier.</li>
</ol>
<ul>

<li>The flickr server identifier.</li>
<li>The flickr image identifier.</li>
<li>The image secret.</li>
<li>The original image secret (if available).</li>
<li>The URL to the medium sized image.</li>
<li>The directory the image is stored in after being downloaded.</li>
<li>The image title (if present).</li>
<li>The image description (if present).</li>
<li>The license identifier of the image (see <a class="externalLink" href="http://www.flickr.com/services/api/flickr.photos.licenses.getInfo.html">flickr.photos.licenses.getInfo</a> to see what this means)</li>
<li>The date the photo was posted to Flickr.</li>
<li>The date the photo was taken taken.</li>
<li>The Flickr identifier of the photos owner.</li>
<li>The Flickr username of the owner.</li>
<li>The geo accuracy (<a class="externalLink" href="http://www.flickr.com/services/api/flickr.photos.geo.setLocation.html">see flickr.photos.geo.setLocation</a>).</li>
<li>The latitude at which the photo was taken, if available.</li>
<li>The longitude at which the photo was taken, if available.</li>
<li>The Flickr tags associated with the image (if present).</li>
</ul>
</li>
</ul>
<h1>The DownloadMissingImages.groovy Script</h1>
<p>Sometimes the FlickrCrawler will fail to download some images (for example, because of network issues). The <tt>DownloadMissingImages.groovy</tt> script will parse the <tt>images.csv</tt> file from a crawl and automatically attempt to download any missing images. Usage is simple; just run the script with the path to the crawl output directory (the <tt>outputdir</tt> specified in your original configuration):</p>

<div>
<div>
<pre class="source">groovy DownloadMissingImages.groovy crawldir
</pre></div></div></div>
        </div>
    </div>
    <hr/>
    <footer>
      <div class="container">
        <div class="row">
            <p>Copyright &copy;2011&#x2013;2018
<a href="http://www.soton.ac.uk">The University of Southampton</a>.
All rights reserved.</p>
        </div>
        <p id="poweredBy" class="pull-right"><a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
</p>
    <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="https://www.ohloh.net/p/openimaj/widgets/project_partner_badge.js"></script>
    </div>
        </div>
    </footer>
  </body>
</html>
